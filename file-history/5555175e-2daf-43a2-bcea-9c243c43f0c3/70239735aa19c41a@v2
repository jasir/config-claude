# Developer Guide

PrÅ¯vodce pro vÃ½vojÃ¡Å™e pÅ™ispÃ­vajÃ­cÃ­ do **git-composer**.

## Architektura projektu

### Technologie

- **Runtime:** bun (v1.2.21+)
- **Jazyk:** TypeScript
- **CLI Framework:** Commander.js
- **Git Operations:** simple-git
- **Code Formatting:** Prettier s import sorting pluginem

### Struktura projektu

```
git-composer/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ index.ts              # Main CLI entry point
â”‚   â”œâ”€â”€ config/               # Configuration handling
â”‚   â”‚   â”œâ”€â”€ constants.ts
â”‚   â”‚   â”œâ”€â”€ types.ts
â”‚   â”‚   â”œâ”€â”€ loadConfig.ts
â”‚   â”‚   â”œâ”€â”€ getRepositoriesFromConfig.ts
â”‚   â”‚   â””â”€â”€ index.ts
â”‚   â”œâ”€â”€ configuration/        # Config-related utilities
â”‚   â”‚   â”œâ”€â”€ loadAndValidateConfig.ts
â”‚   â”‚   â””â”€â”€ index.ts
â”‚   â”œâ”€â”€ core/                 # Core application logic
â”‚   â”‚   â”œâ”€â”€ withConfig.ts
â”‚   â”‚   â””â”€â”€ index.ts
â”‚   â”œâ”€â”€ directory/            # Directory operations
â”‚   â”‚   â”œâ”€â”€ executeCommandInRepos.ts
â”‚   â”‚   â””â”€â”€ index.ts
â”‚   â”œâ”€â”€ gitOperations/        # Git operations
â”‚   â”‚   â”œâ”€â”€ cloneOperations.ts
â”‚   â”‚   â”œâ”€â”€ fetchOperations.ts
â”‚   â”‚   â”œâ”€â”€ processOperations.ts
â”‚   â”‚   â”œâ”€â”€ extractOperations.ts
â”‚   â”‚   â”œâ”€â”€ addOperations.ts
â”‚   â”‚   â”œâ”€â”€ discoverOperations.ts
â”‚   â”‚   â”œâ”€â”€ commitAllRepositories.ts
â”‚   â”‚   â”œâ”€â”€ commitRepository.ts
â”‚   â”‚   â”œâ”€â”€ handleInteractiveCommit.ts
â”‚   â”‚   â”œâ”€â”€ handleInteractiveRebase.ts
â”‚   â”‚   â”œâ”€â”€ pullRepository.ts
â”‚   â”‚   â”œâ”€â”€ pullAllRepositories.ts
â”‚   â”‚   â”œâ”€â”€ pushRepository.ts
â”‚   â”‚   â”œâ”€â”€ pushAllRepositories.ts
â”‚   â”‚   â”œâ”€â”€ syncRepository.ts
â”‚   â”‚   â”œâ”€â”€ syncRepositories.ts
â”‚   â”‚   â”œâ”€â”€ checkRepositoryStatus.ts
â”‚   â”‚   â”œâ”€â”€ displayGitDiff.ts
â”‚   â”‚   â”œâ”€â”€ runInteractiveShell.ts
â”‚   â”‚   â””â”€â”€ index.ts
â”‚   â”œâ”€â”€ os/                   # OS-specific utilities
â”‚   â”‚   â”œâ”€â”€ isWindows.ts
â”‚   â”‚   â”œâ”€â”€ isWindowsPath.ts
â”‚   â”‚   â”œâ”€â”€ windowsToUnix.ts
â”‚   â”‚   â”œâ”€â”€ unixToWindows.ts
â”‚   â”‚   â””â”€â”€ index.ts
â”‚   â””â”€â”€ ui/                   # User interface components
â”‚       â”œâ”€â”€ showStatus.ts
â”‚       â”œâ”€â”€ progressIndicator.ts
â”‚       â”œâ”€â”€ stripAnsiCodes.ts
â”‚       â””â”€â”€ index.ts
â”œâ”€â”€ doc/                      # Documentation
â”œâ”€â”€ tests/                    # Tests
â”œâ”€â”€ git-compose               # Wrapper script
â”œâ”€â”€ package.json
â”œâ”€â”€ tsconfig.json
â”œâ”€â”€ .git-compose.yaml
â”œâ”€â”€ CLAUDE.md                 # AI assistant instructions
â””â”€â”€ README.md
```

## VÃ½vojovÃ© konvence

### Code Style

**1 funkce = 1 soubor**
```typescript
// âœ… SprÃ¡vnÄ›: KaÅ¾dÃ¡ funkce ve vlastnÃ­m souboru
// src/gitOperations/cloneRepository.ts
export async function cloneRepository(...) { }

// src/gitOperations/pushRepository.ts
export async function pushRepository(...) { }
```

**Preferujte malÃ© znovupouÅ¾itelnÃ© funkce**
```typescript
// âœ… DobrÃ©: MalÃ©, zamÄ›Å™enÃ© funkce
export function isWindowsPath(path: string): boolean {
  return /^[A-Z]:[\\\/]/.test(path);
}

// âŒ Å patnÃ©: PÅ™Ã­liÅ¡ velkÃ¡ funkce dÄ›lajÃ­cÃ­ mnoho vÄ›cÃ­
export function handleAllPathConversions(...) { }
```

**ANSI vÃ½stup s bold a italic**
```typescript
// Pro UX pouÅ¾Ã­vejte bold a italic kde je to vhodnÃ©
import chalk from 'chalk';

console.log(chalk.bold.green('âœ“ Success'));
console.log(chalk.italic.gray('Details...'));
console.log(chalk.bold.red('âœ— Error'));
```

## Development Workflow

### Setup vÃ½vojovÃ©ho prostÅ™edÃ­

```bash
# 1. Clone repozitÃ¡Å™e
git clone git@github.com:jasir/git-composer.git
cd git-composer

# 2. Instalace dependencies
bun install

# 3. VytvoÅ™te feature branch
git checkout -b feature/your-feature-name
```

### SpuÅ¡tÄ›nÃ­ projektu

**PrimÃ¡rnÃ­ metoda:**
```bash
./git-compose <command>
```

**AlternativnÃ­ metoda:**
```bash
bun run src/index.ts <command>
```

### Testing

```bash
# RuÄnÃ­ testovÃ¡nÃ­
./git-compose build --verbose
./git-compose status
./git-compose exec "echo test"

# Test s testovacÃ­m configem
./git-compose --config ./tests/.git-compose.test.yaml build
```

### Code Formatting

```bash
# Format vÅ¡ech souborÅ¯
bun run format

# Nebo pouÅ¾ijte Prettier pÅ™Ã­mo
npx prettier --write "src/**/*.ts"
```

## PÅ™idÃ¡nÃ­ novÃ© funkcionality

### 1. PÅ™idÃ¡nÃ­ novÃ©ho pÅ™Ã­kazu

**Krok 1:** VytvoÅ™te operation soubor
```typescript
// src/gitOperations/myNewOperation.ts
import { GitRepo } from '../config/types';

export async function myNewOperation(
  repos: GitRepo[],
  options: { verbose?: boolean }
): Promise<void> {
  for (const repo of repos) {
    // VaÅ¡e implementace
  }
}
```

**Krok 2:** Exportujte z index
```typescript
// src/gitOperations/index.ts
export { myNewOperation } from './myNewOperation';
```

**Krok 3:** PÅ™idejte pÅ™Ã­kaz do CLI
```typescript
// src/index.ts
import { myNewOperation } from './gitOperations';

program
  .command('my-command')
  .description('Description of my command')
  .option('--verbose', 'Verbose output')
  .action(async (options) => {
    await withConfig(options, async (config) => {
      const repos = getRepositoriesFromConfig(config);
      await myNewOperation(repos, options);
    });
  });
```

**Krok 4:** Aktualizujte dokumentaci
- PÅ™idejte do `doc/usage.md`
- Aktualizujte pÅ™Ã­klady v `doc/quick-start.md`
- PÅ™idejte troubleshooting do `doc/troubleshooting.md`

### 2. PÅ™idÃ¡nÃ­ novÃ© utility funkce

```typescript
// src/utils/myUtility.ts
export function myUtility(input: string): string {
  // Implementace
  return result;
}

// src/utils/index.ts
export { myUtility } from './myUtility';
```

### 3. PÅ™idÃ¡nÃ­ novÃ© config moÅ¾nosti

**Krok 1:** Aktualizujte typy
```typescript
// src/config/types.ts
export interface Config {
  target: string;
  repos: GitRepo[];
  myNewOption?: string; // PÅ™idejte novou moÅ¾nost
}
```

**Krok 2:** Aktualizujte loadConfig
```typescript
// src/config/loadConfig.ts
export function loadConfig(path: string): Config {
  const data = yaml.load(fs.readFileSync(path, 'utf8'));

  return {
    target: data.target,
    repos: data.repos,
    myNewOption: data.myNewOption, // NaÄtÄ›te novou moÅ¾nost
  };
}
```

**Krok 3:** PouÅ¾ijte v operations
```typescript
// src/gitOperations/someOperation.ts
export async function someOperation(config: Config) {
  if (config.myNewOption) {
    // PouÅ¾ijte novou moÅ¾nost
  }
}
```

## Debugging

### Verbose Mode

```bash
# ZapnÄ›te verbose vÃ½stup
./git-compose build --verbose

# V kÃ³du
if (options.verbose) {
  console.log(chalk.gray('Debug info...'));
}
```

### Environment Variables

```typescript
// Kontrola environment
console.log('CWD:', process.cwd());
console.log('ORIGINAL_CWD:', process.env.ORIGINAL_CWD);
console.log('Platform:', process.platform);
```

### Debugging Git Operations

```typescript
// PouÅ¾ijte simple-git s debugging
import simpleGit from 'simple-git';

const git = simpleGit(repoPath, {
  binary: 'git',
  maxConcurrentProcesses: 1
});

// Log vÅ¡ech git pÅ™Ã­kazÅ¯
git.outputHandler((command, stdout, stderr) => {
  console.log('Git command:', command);
  stdout.pipe(process.stdout);
  stderr.pipe(process.stderr);
});
```

## TestovÃ¡nÃ­

### ManuÃ¡lnÃ­ testovacÃ­ scÃ©nÃ¡Å™e

**Test 1: Basic build**
```bash
# Setup
cat > test-config.yaml << 'EOF'
target: ./test-workspace
repos:
  - path: .
    branch: main
    origin: https://github.com/PIC16B/git-practice.git
EOF

# Test
./git-compose --config test-config.yaml build
./git-compose --config test-config.yaml status

# Cleanup
rm -rf ./test-workspace test-config.yaml
```

**Test 2: Extract**
```bash
# Setup
git clone https://github.com/PIC16B/git-practice.git test-source
mkdir -p test-source/subdir
echo "test" > test-source/subdir/file.txt
cd test-source && git add . && git commit -m "Add subdir" && cd ..

# Test
./git-compose extract ./test-source ./test-source/subdir --dry-run
./git-compose extract ./test-source ./test-source/subdir --force

# Cleanup
rm -rf test-source
```

**Test 3: Sync workflow**
```bash
# Setup workspace s vÃ­ce repozitÃ¡Å™i
# ProveÄte zmÄ›ny
# Test sync
./git-compose sync --verbose
```

## PÅ™Ã­spÃ­vÃ¡nÃ­

### Pull Request Workflow

**1. VytvoÅ™te feature branch**
```bash
git checkout -b feature/add-awesome-feature
```

**2. ProveÄte zmÄ›ny**
```bash
# VaÅ¡e zmÄ›ny
git add .
git commit -m "feat: add awesome feature"
```

**3. Push a vytvoÅ™te PR**
```bash
git push origin feature/add-awesome-feature
# VytvoÅ™te PR na GitHubu
```

### Commit Message Konvence

PouÅ¾Ã­vÃ¡me [Conventional Commits](https://www.conventionalcommits.org/):

```
feat: pÅ™idÃ¡nÃ­ novÃ© funkcionality
fix: oprava bugu
docs: zmÄ›ny v dokumentaci
style: formÃ¡tovÃ¡nÃ­, chybÄ›jÃ­cÃ­ stÅ™ednÃ­ky, atd.
refactor: refaktoring kÃ³du
test: pÅ™idÃ¡nÃ­ testÅ¯
chore: ÃºdrÅ¾ba, dependencies, atd.
```

**PÅ™Ã­klady:**
```
feat: add discover command
fix: handle path conversion on Windows
docs: update usage guide
refactor: split large function into smaller ones
chore: update dependencies
```

## Best Practices

### Error Handling

```typescript
// âœ… VÅ¾dy zachyÅ¥te a sprÃ¡vnÄ› zpracujte chyby
try {
  await git.clone(origin, path);
} catch (error) {
  console.error(chalk.red(`âœ— Failed to clone: ${error.message}`));
  if (options.verbose) {
    console.error(chalk.gray(error.stack));
  }
  throw error; // nebo return false
}
```

### User Feedback

```typescript
// âœ… Poskytujte vizuÃ¡lnÃ­ feedback
console.log(chalk.bold.cyan('âš¡ Processing repositories...'));
console.log(chalk.green('âœ“ Success'));
console.log(chalk.yellow('âš  Warning'));
console.log(chalk.red('âœ— Error'));
console.log(chalk.gray('  Details...'));
```

### Path Handling

```typescript
// âœ… VÅ¾dy normalizujte cesty
import path from 'path';

const normalizedPath = path.normalize(userPath);
const absolutePath = path.resolve(normalizedPath);

// âœ… PouÅ¾ijte OS-specific funkce
import { isWindowsPath, windowsToUnix } from './os';

if (isWindowsPath(targetPath)) {
  targetPath = windowsToUnix(targetPath);
}
```

### Async Operations

```typescript
// âœ… PouÅ¾ijte async/await
async function processRepos(repos: GitRepo[]) {
  for (const repo of repos) {
    await processRepo(repo);
  }
}

// âœ… Pro paralelnÃ­ operace
await Promise.all(repos.map(repo => processRepo(repo)));
```

## VydÃ¡vÃ¡nÃ­ novÃ½ch verzÃ­

### Semantic Versioning

PouÅ¾Ã­vÃ¡me [SemVer](https://semver.org/):

- **MAJOR** (1.x.x): Breaking changes
- **MINOR** (x.1.x): NovÃ© funkcionality (backward compatible)
- **PATCH** (x.x.1): Bug fixes

### Release Process

```bash
# 1. Aktualizujte CHANGELOG.md
# 2. Aktualizujte verzi v package.json a README.md
# 3. Commit
git add .
git commit -m "chore: release v1.1.0"

# 4. Tag
git tag v1.1.0

# 5. Push
git push origin main --tags
```

## DÅ¯leÅ¾itÃ© soubory

### CLAUDE.md

Soubor s instrukcemi pro AI asistenty (Claude Code). Aktualizujte ho pÅ™i pÅ™idÃ¡vÃ¡nÃ­ novÃ½ch funkcÃ­ nebo zmÄ›nÄ› architektury.

### package.json

```json
{
  "name": "git-composer",
  "version": "1.0.0",
  "scripts": {
    "format": "prettier --write \"src/**/*.ts\""
  }
}
```

### tsconfig.json

TypeScript konfigurace - standardnÃ­ nastavenÃ­ pro Node.js projekt.

## DalÅ¡Ã­ zdroje

- [Commander.js Docs](https://github.com/tj/commander.js/)
- [simple-git Docs](https://github.com/steveukx/git-js)
- [Chalk Docs](https://github.com/chalk/chalk)
- [Prettier Docs](https://prettier.io/docs/en/)

## Kontakt

- **GitHub Issues:** https://github.com/jasir/git-composer/issues
- **Pull Requests:** https://github.com/jasir/git-composer/pulls

DÄ›kujeme za vÃ¡Å¡ pÅ™Ã­nos! ğŸ‰