---
namespace: epks
document:
  enabled: true
  name: epks-administration-documentation
  tags: [administrace, sprÃ¡va, pÅ™ihlÃ¡Å¡ky, jÃ­delna]
  version: v1.0.0
  created: 2025-09-29
---

# EPKS - Administrace systÃ©mu

Dokumentace administraÄnÃ­ho rozhranÃ­ projektu EPKS pro sprÃ¡vu elektronickÃ½ch pÅ™ihlÃ¡Å¡ek ke stravovÃ¡nÃ­.

## ğŸ¯ PÅ™ehled administrace

EPKS mÃ¡ **3 ÃºrovnÄ› administrace**:

### 1. ğŸ‘¨â€ğŸ³ Administrace jÃ­delny
**URL:** `/administrace/:canteen_slug`
**ÃšÄel:** SprÃ¡va pÅ™ihlÃ¡Å¡ek pro konkrÃ©tnÃ­ jÃ­delnu
**PÅ™Ã­stup:** AdministrÃ¡tor jednotlivÃ© jÃ­delny (vyÅ¾aduje pÅ™ihlÃ¡Å¡enÃ­ heslem)

### 2. ğŸ” InternÃ­ administrace
**URL:** `/pages/epks/interni-administrace`
**ÃšÄel:** CentrÃ¡lnÃ­ sprÃ¡va vÅ¡ech jÃ­delen a formulÃ¡Å™Å¯
**PÅ™Ã­stup:** Superadmin (vyÅ¾aduje pÅ™ihlÃ¡Å¡enÃ­ do ENT systÃ©mu)

### 3. âš™ï¸ Konfigurace stojanÅ¯
**URL:** `/pages/epks/konfigurace-stojanu`
**ÃšÄel:** Konfigurace kioskÅ¯/stojanÅ¯ pro samoobsluÅ¾nÃ© vyplÅˆovÃ¡nÃ­
**PÅ™Ã­stup:** AdministrÃ¡tor nebo superadmin

## ğŸ“‹ Administrace jÃ­delny (epks-admin.page.md)

### ZÃ¡kladnÃ­ informace
- **StrÃ¡nka:** `pages/administrace/epks-admin.page.md`
- **Route:** `epks/administrace/:rest(*)`
- **Public route:** `/administrace`
- **Layout:** Custom s vlastnÃ­m headerem

### Funkce
- **PÅ™ihlÃ¡Å¡enÃ­ heslem** - zabezpeÄenÃ½ pÅ™Ã­stup k pÅ™ihlÃ¡Å¡kÃ¡m
- **Seznam pÅ™ihlÃ¡Å¡ek** - tabulka vÅ¡ech pÅ™ihlÃ¡Å¡ek s filtrovÃ¡nÃ­m
- **Detail pÅ™ihlÃ¡Å¡ky** - zobrazenÃ­ a Ãºprava jednotlivÃ© pÅ™ihlÃ¡Å¡ky
- **Tisk formulÃ¡Å™e** - moÅ¾nost vytisknout vyplnÄ›nÃ½ formulÃ¡Å™
- **NastavenÃ­** - konfigurace formulÃ¡Å™e pro jÃ­delnu

### Struktura dat

```js
// Persistent data - uchovÃ¡vÃ¡ se v localStorage
{
  isLogged: false,      // Je uÅ¾ivatel pÅ™ihlÃ¡Å¡en?
  editedTab: 'seznam'   // AktivnÃ­ tab (seznam/nastavenÃ­)
}

// Server data - naÄÃ­tÃ¡ se ze serveru
{
  canteen: 'loading'    // Data o jÃ­delnÄ›
}

// URL parametry
{
  canteen_slug: 'string' // Slug jÃ­delny (napÅ™. 'zakladni-skola-praha')
}
```

### Taby v administraci

#### Tab "Seznam"
Zobrazuje tabulku vÅ¡ech pÅ™ihlÃ¡Å¡ek pomocÃ­ komponenty [[epks.admin-responses-table]]

#### Tab "NastavenÃ­"
Konfigurace formulÃ¡Å™e pomocÃ­ komponenty [[epks.admin-settings]]

## ğŸ“Š Tabulka pÅ™ihlÃ¡Å¡ek (AdminResponsesTable)

### ZÃ¡kladnÃ­ informace
- **Komponenta:** `pages/administrace/components/epks.admin-responses-table.component.md`
- **ÃšÄel:** ZobrazenÃ­ seznamu vÅ¡ech pÅ™ihlÃ¡Å¡ek s moÅ¾nostÃ­ filtrovÃ¡nÃ­ a Å™azenÃ­

### Props
```js
{
  canteenId: Number,    // ID jÃ­delny
  canteen: Object       // Objekt jÃ­delny s nastavenÃ­m
}
```

### Filtry a stavy pÅ™ihlÃ¡Å¡ek

#### Stavy pÅ™ihlÃ¡Å¡ek
| ID | Stav | Popis |
|---|---|---|
| 2 | NezpracovanÃ© | NovÄ› pÅ™Ã­chozÃ­ pÅ™ihlÃ¡Å¡ky ÄekajÃ­cÃ­ na kontrolu |
| 3 | ÄŒekÃ¡ na opravu | PÅ™ihlÃ¡Å¡ka vrÃ¡cena rodiÄÅ¯m k opravÄ› |
| 4 | ZpracovanÃ© | ZkontrolovanÃ© a schvÃ¡lenÃ© pÅ™ihlÃ¡Å¡ky |
| 5 | ArchivovanÃ© | StarÅ¡Ã­ pÅ™ihlÃ¡Å¡ky pÅ™esunutÃ© do archivu |
| 99 | VadnÃ© | PÅ™ihlÃ¡Å¡ky s chybami, kterÃ© nelze opravit |

#### FiltrovacÃ­ moÅ¾nosti
```js
filter: {
  text: '',              // FulltextovÃ© hledÃ¡nÃ­
  nezpracovane: true,    // Zobrazit nezpracovanÃ©
  archivovane: false,    // Zobrazit archivovanÃ©
  vlozene: false,        // Zobrazit vloÅ¾enÃ© do systÃ©mu
  vadne: false,          // Zobrazit vadnÃ©
  zpracovane: false,     // Zobrazit zpracovanÃ©
}
```

### PersistentnÃ­ data
Filtry a nastavenÃ­ se **uklÃ¡dajÃ­ do localStorage**:
```js
persistentData: {
  filter: { keys: ['filter', 'editedFilterStatuses'] },
  options: { keys: ['options'] }
}
```

### AutomatickÃ© naÄÃ­tÃ¡nÃ­
Tabulka se **automaticky aktualizuje kaÅ¾dÃ½ch 5 sekund**:
```js
timers: {
  reloadServerData: {
    time: 5000,      // 5 sekund
    autostart: true,
    repeat: true
  }
}
```

### Quick filter
RychlÃ© vyhledÃ¡vÃ¡nÃ­ v tabulce pro okamÅ¾itÃ© filtrovÃ¡nÃ­ dle:
- JmÃ©no a pÅ™Ã­jmenÃ­ stravnÃ­ka
- Email zÃ¡konnÃ©ho zÃ¡stupce
- Telefon zÃ¡konnÃ©ho zÃ¡stupce
- VariabilnÃ­ symbol

### Funkce v tabulce
- **KliknutÃ­ na Å™Ã¡dek** - otevÅ™e detail pÅ™ihlÃ¡Å¡ky
- **BarevnÃ© oznaÄenÃ­** - rÅ¯znÃ© barvy pro rÅ¯znÃ© stavy
- **Å˜azenÃ­** - moÅ¾nost Å™adit podle sloupcÅ¯
- **Export** - moÅ¾nost exportu do CSV/Excel

## ğŸ“ Detail pÅ™ihlÃ¡Å¡ky (AdminResponseDetail)

### ZÃ¡kladnÃ­ informace
- **Komponenta:** `pages/administrace/components/epks.admin-response-detail.component.md`
- **ÃšÄel:** ZobrazenÃ­ a Ãºprava jednotlivÃ© pÅ™ihlÃ¡Å¡ky

### Props
```js
{
  responseId: Number,          // ID pÅ™ihlÃ¡Å¡ky
  initialResponse: Object,     // PÅ¯vodnÃ­ data pÅ™ihlÃ¡Å¡ky
  canteen: Object,            // Data jÃ­delny
  options: Object             // NastavenÃ­ zobrazenÃ­
}
```

### EditovatelnÃ¡ pole

#### ZÃ¡kladnÃ­ Ãºdaje
```js
{
  editedTrida: undefined,           // Å kolnÃ­ tÅ™Ã­da
  editedKategorie: '',              // Kategorie stravnÃ­ka
  editedDatumZacatku: '',          // Datum zaÄÃ¡tku stravovÃ¡nÃ­
  editedJmeno: '',                  // JmÃ©no stravnÃ­ka
  variabilniSymbol: ''              // VS pro platby
}
```

#### Email Å¾Ã¡dosti o opravu
```js
{
  editedOpravaText: 'DobrÃ½ den, prosÃ­m opravte... ',
  editedOpravaEmail: '',            // Email pÅ™Ã­jemce
  editedOpravaBccEmail: '',         // BCC kopie
  editedOpravaBcc: true            // Poslat BCC?
}
```

#### FinÃ¡lnÃ­ email po schvÃ¡lenÃ­
```js
{
  editedFinalEmail: '',             // Email s pÅ™Ã­stupovÃ½mi Ãºdaji
  editedFinalBccEmail: '',          // BCC kopie
  editedFinalBcc: false            // Poslat BCC?
}
```

### Validace

#### VariabilnÃ­ symbol
```js
validations: {
  variabilniSymbol: {
    isUnique: async (value) => {
      // Kontrola, zda VS nenÃ­ jiÅ¾ pouÅ¾itÃ½
      return await vm.isVariableSymbolUnique(value)
    }
  }
}
```

**ChybovÃ© hlÃ¡Å¡ky:**
- `required`: "informaci musÃ­te vyplnit"
- `isUnique`: "variabilnÃ­ symbol jiÅ¾ byl pÅ™idÄ›len jinÃ©mu strÃ¡vnÃ­kovi"

### Server data
```js
serverData: {
  response: 'loading',        // Data pÅ™ihlÃ¡Å¡ky
  insertedInfo: 'loading'     // Info o vloÅ¾enÃ­ do systÃ©mu
}
```

### Akce v detailu

#### 1. ğŸ’¾ UloÅ¾it zmÄ›ny
- UloÅ¾Ã­ editovanÃ© Ãºdaje do databÃ¡ze
- Aktualizuje stav pÅ™ihlÃ¡Å¡ky

#### 2. âœ‰ï¸ Poslat Å¾Ã¡dost o opravu
- ZmÄ›nÃ­ stav na "ÄekÃ¡ na opravu"
- OdeÅ¡le email rodiÄÅ¯m s poÅ¾adavky na opravu
- MoÅ¾nost BCC kopie pro jÃ­delnu

#### 3. âœ… SchvÃ¡lit pÅ™ihlÃ¡Å¡ku
- ZmÄ›nÃ­ stav na "zpracovanÃ©"
- OdeÅ¡le email s pÅ™Ã­stupovÃ½mi Ãºdaji
- VloÅ¾Ã­ stravnÃ­ka do systÃ©mu (pokud je integrace)

#### 4. ğŸ—‘ï¸ Archivovat
- ZmÄ›nÃ­ stav na "archivovanÃ©"
- PÅ™esune pÅ™ihlÃ¡Å¡ku mimo aktivnÃ­ seznam

#### 5. âš ï¸ OznaÄit jako vadnou
- ZmÄ›nÃ­ stav na "vadnÃ©"
- Pro pÅ™ihlÃ¡Å¡ky, kterÃ© nelze zpracovat

#### 6. ğŸ–¨ï¸ Vytisknout
- OtevÅ™e [[epks.admin-print]] komponentu
- PÅ™ipravÃ­ formulÃ¡Å™ pro tisk

## ğŸ–¨ï¸ Tisk formulÃ¡Å™e (AdminPrint)

### ZÃ¡kladnÃ­ informace
- **Komponenta:** `pages/administrace/components/epks.admin-print.component.md`
- **ÃšÄel:** Tisk vyplnÄ›nÃ© pÅ™ihlÃ¡Å¡ky v ÄitelnÃ©m formÃ¡tu

### Funkce
- **FormÃ¡tovanÃ© zobrazenÃ­** - vÅ¡echny Ãºdaje pÅ™ehlednÄ›
- **Logo jÃ­delny** - vlastnÃ­ logo v zÃ¡hlavÃ­
- **QR kÃ³d** - pro rychlÃ½ pÅ™Ã­stup k pÅ™ihlÃ¡Å¡ce
- **PodpisovÃ¡ pole** - pro rodiÄe a administrÃ¡tora
- **CSS pro tisk** - optimalizovanÃ© styly pro tiskÃ¡rnu

### TiskovÃ© formÃ¡ty
- **A4 na vÃ½Å¡ku** - standardnÃ­ formÃ¡t
- **Bez barev** - optimalizovÃ¡no pro ÄernobÃ­lÃ½ tisk
- **StrÃ¡nkovÃ¡nÃ­** - automatickÃ© rozdÄ›lenÃ­ na strÃ¡nky

## âš™ï¸ NastavenÃ­ formulÃ¡Å™e (AdminSettings)

### ZÃ¡kladnÃ­ informace
- **Komponenta:** `pages/administrace/components/epks.admin-settings.component.md`
- **ÃšÄel:** Konfigurace formulÃ¡Å™e pro jÃ­delnu

### NastavitelnÃ© poloÅ¾ky

#### ZÃ¡kladnÃ­ informace
- **NÃ¡zev jÃ­delny** - zobrazovanÃ½ nÃ¡zev
- **Logo** - nahrÃ¡nÃ­ loga jÃ­delny
- **KontaktnÃ­ email** - pro notifikace
- **Jazyky** - aktivnÃ­ jazykovÃ© mutace

#### FormulÃ¡Å™ovÃ© pole
- **PovinnÃ¡ pole** - vÃ½bÄ›r povinnÃ½ch polÃ­
- **SkrytÃ¡ pole** - vÃ½bÄ›r skrytÃ½ch polÃ­
- **VÃ½chozÃ­ hodnoty** - pÅ™edvyplnÄ›nÃ­ polÃ­

#### Email nastavenÃ­
- **BCC adresa** - automatickÃ¡ kopie vÅ¡ech emailÅ¯
- **Å ablony** - vÃ½bÄ›r emailovÃ½ch Å¡ablon
- **Podpis** - vlastnÃ­ podpis v emailech

#### Integrace
- **E-jÃ­delnÃ­Äek** - integrace s e-jÃ­delnÃ­Äek systÃ©mem
- **Å½olÃ­k** - integrace s Å¾olÃ­k platbami
- **Central Server** - napojenÃ­ na centrÃ¡lnÃ­ server

#### Vzhled
- **Barvy** - vlastnÃ­ barevnÃ© schÃ©ma
- **Fonty** - vÃ½bÄ›r fontÅ¯
- **CSS** - vlastnÃ­ CSS styly

## ğŸ¢ InternÃ­ administrace

### ZÃ¡kladnÃ­ informace
- **StrÃ¡nka:** `pages/interni-administrace/epks-interni-administrace.page.md`
- **Route:** `/pages/epks/interni-administrace`
- **PÅ™Ã­stup:** Jen pro superadminy pÅ™ihlÃ¡Å¡enÃ© v ENT systÃ©mu

### Komponenty internÃ­ administrace

#### 1. SprÃ¡va jÃ­delen (CanteensAdmin)
**Komponenta:** `canteens-admin.component.md`

**Funkce:**
- Seznam vÅ¡ech jÃ­delen
- VytvoÅ™enÃ­ novÃ© jÃ­delny
- Ãšprava ÃºdajÅ¯ jÃ­delny
- Deaktivace/aktivace jÃ­delny
- GenerovÃ¡nÃ­ slug pro URL
- NastavenÃ­ hesla pro administraci

#### 2. Superadmin jÃ­delen (CanteensSuperadmin)
**Komponenta:** `canteens-superadmin.component.md`

**RozÅ¡Ã­Å™enÃ© funkce:**
- PÅ™Ã­stup ke vÅ¡em jÃ­delnÃ¡m
- ZmÄ›na vlastnictvÃ­ jÃ­delen
- Migrace dat mezi jÃ­delnami
- Statistiky napÅ™Ã­Ä systÃ©mem
- Export vÅ¡ech dat

#### 3. SprÃ¡va formulÃ¡Å™Å¯ (FormsAdmin)
**Komponenta:** `epks.forms-admin.component.md`

**Funkce:**
- GlobÃ¡lnÃ­ Å¡ablony formulÃ¡Å™Å¯
- VytvoÅ™enÃ­ novÃ©ho typu formulÃ¡Å™e
- KlonovÃ¡nÃ­ formulÃ¡Å™Å¯
- NastavenÃ­ polÃ­ pro vÅ¡echny jÃ­delny
- VerzovÃ¡nÃ­ formulÃ¡Å™Å¯

#### 4. PÅ™ehled odpovÄ›dÃ­ (InternalCanteenResponses)
**Komponenta:** `epks.internal-canteen-responses.component.md`

**Funkce:**
- CelkovÃ½ pÅ™ehled pÅ™ihlÃ¡Å¡ek
- FiltrovÃ¡nÃ­ podle jÃ­delen
- Statistiky ÃºspÄ›Å¡nosti
- Export dat
- HromadnÃ© operace

#### 5. FormulÃ¡Å™ pro jÃ­delny (InternlCanteenForm)
**Komponenta:** `epks.internl-canteen-form.component.md`

**Funkce:**
- VytvoÅ™enÃ­/Ãºprava jÃ­delny
- NastavenÃ­ integracÃ­
- Konfigurace emailÅ¯
- PÅ™iÅ™azenÃ­ administrÃ¡torÅ¯

## ğŸ” PÅ™ihlÃ¡Å¡enÃ­ a autentizace

### PÅ™ihlÃ¡Å¡enÃ­ do administrace jÃ­delny

```js
// JednoduchÃ© pÅ™ihlÃ¡Å¡enÃ­ heslem
async login() {
  const result = await this.callRestApi({
    func: 'loginCanteen',
    payload: {
      canteenSlug: this.canteen_slug,
      password: this.password
    }
  })

  if (result.success) {
    this.isLogged = true
    this.loginError = false
  } else {
    this.loginError = true
  }
}
```

### PÅ™ihlÃ¡Å¡enÃ­ do internÃ­ administrace
- PouÅ¾Ã­vÃ¡ **ENT autentizaci**
- Kontrola uÅ¾ivatelskÃ½ch prÃ¡v
- Session management
- Token-based autorizace

## ğŸ“Š Workflow administrace

### Proces zpracovÃ¡nÃ­ pÅ™ihlÃ¡Å¡ky

```
1. NovÃ¡ pÅ™ihlÃ¡Å¡ka pÅ™ijde (status: nezpracovanÃ©)
   â†“
2. AdministrÃ¡tor otevÅ™e detail
   â†“
3. Zkontroluje vÅ¡echny Ãºdaje
   â†“
4a. VÅ¡e OK â†’ SchvÃ¡lÃ­ pÅ™ihlÃ¡Å¡ku
    â†’ Status: zpracovanÃ©
    â†’ OdeÅ¡le email s pÅ™Ã­stupovÃ½mi Ãºdaji
    â†’ VloÅ¾Ã­ do systÃ©mu stravovÃ¡nÃ­

4b. Chyba â†’ Å½Ã¡dost o opravu
    â†’ Status: ÄekÃ¡ na opravu
    â†’ OdeÅ¡le email s poÅ¾adavky
    â†’ ÄŒekÃ¡ na reakci rodiÄe

4c. Nelze zpracovat â†’ VadnÃ¡
    â†’ Status: vadnÃ©
    â†’ Kontaktuje rodiÄe jinÃ½m zpÅ¯sobem
```

## ğŸ› ï¸ Best practices pro administrÃ¡tory

### âœ… DoporuÄenÃ© postupy

1. **PravidelnÃ¡ kontrola** - minimÃ¡lnÄ› 1x dennÄ› zkontrolovat novÃ© pÅ™ihlÃ¡Å¡ky
2. **RychlÃ¡ reakce** - odpovÄ›dÄ›t do 24 hodin od pÅ™ijetÃ­ pÅ™ihlÃ¡Å¡ky
3. **JasnÃ¡ komunikace** - v emailech jasnÄ› popsat, co je tÅ™eba opravit
4. **Archivace** - starÅ¡Ã­ pÅ™ihlÃ¡Å¡ky archivovat pro pÅ™ehlednost
5. **ZÃ¡loha** - pravidelnÄ› exportovat data pro zÃ¡lohu

### âŒ ÄŒastÃ© chyby

1. **NeschvÃ¡lenÃ­ bez emailu** - vÅ¾dy odeslat potvrzovacÃ­ email
2. **DuplikÃ¡tnÃ­ VS** - kontrolovat unikÃ¡tnost variabilnÃ­ch symbolÅ¯
3. **ZapomenutÃ­ BCC** - nastavit automatickÃ© BCC pro evidenci
4. **NeÃºplnÃ© Ãºdaje** - zkontrolovat vÅ¡echny povinnÃ© poloÅ¾ky

## ğŸ” Debugging a Å™eÅ¡enÃ­ problÃ©mÅ¯

### ÄŒastÃ© problÃ©my

#### PÅ™ihlÃ¡Å¡ky se nenaÄÃ­tajÃ­
```js
// Zkontroluj konzoli
console.log('ZZZ rawResponses:', this.rawResponses)
console.log('ZZZ canteenId:', this.canteenId)
```

#### Email se neodeslal
```js
// Zkontroluj email parametry
console.log('ZZZ email params:', {
  recipient: this.editedOpravaEmail,
  type: 'oprava',
  canteen: this.canteen
})
```

#### Filtr nefunguje
```js
// Zkontroluj filter objekt
console.log('ZZZ filter:', this.filter)
console.log('ZZZ filtered results:', this.filteredResponses)
```

## ğŸ“± Responzivita

Administrace je **plnÄ› responzivnÃ­**:
- **Desktop** - plnÃ¡ funkÄnost, vÅ¡e na jednÃ© obrazovce
- **Tablet** - pÅ™izpÅ¯sobenÃ½ layout, skrÃ½vÃ¡nÃ­ nÄ›kterÃ½ch sloupcÅ¯
- **Mobile** - zjednoduÅ¡enÃ© zobrazenÃ­, karta mÃ­sto tabulky

## ğŸ“š SouvisejÃ­cÃ­ dokumentace

- [[doc/emailing]] - Dokumentace email systÃ©mu
- [[doc/components/epks-main-form]] - Dokumentace hlavnÃ­ho formulÃ¡Å™e
- [[epks.boot]] - Konfigurace serveru a databÃ¡ze

---

*PoslednÃ­ aktualizace: 2025-09-29*
*Autor: Brain Documentation Keeper*