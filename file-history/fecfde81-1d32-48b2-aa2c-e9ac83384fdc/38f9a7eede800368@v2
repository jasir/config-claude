# EPKS - ElektronickÃ¡ pÅ™ihlÃ¡Å¡ka ke stravovÃ¡nÃ­

**Verze:** v2.0.1
**Namespace:** epks
**RepozitÃ¡Å™:** git@github.com:altisima/epks-module.git
**Branch:** develop

## ğŸ“‹ O projektu

EPKS (ElektronickÃ¡ pÅ™ihlÃ¡Å¡ka ke stravovÃ¡nÃ­) je webovÃ¡ aplikace vytvoÅ™enÃ¡ v ENT frameworku pro sprÃ¡vu elektronickÃ½ch pÅ™ihlÃ¡Å¡ek ke stravovÃ¡nÃ­ ve Å¡kolnÃ­ch jÃ­delnÃ¡ch. SystÃ©m umoÅ¾Åˆuje rodiÄÅ¯m vyplnit online formulÃ¡Å™ pro pÅ™ihlÃ¡Å¡enÃ­ jejich dÄ›tÃ­ ke stravovÃ¡nÃ­ a administrÃ¡torÅ¯m jÃ­delen spravovat tyto pÅ™ihlÃ¡Å¡ky.

## ğŸ¯ HlavnÃ­ funkce

- **ğŸ“ Online formulÃ¡Å™ pÅ™ihlÃ¡Å¡ky** - veÅ™ejnÄ› pÅ™Ã­stupnÃ½ formulÃ¡Å™ pro rodiÄe
- **ğŸ‘¥ Administrace jÃ­delen** - sprÃ¡va pÅ™ihlÃ¡Å¡ek pro administratory jednotlivÃ½ch jÃ­delen
- **ğŸ” InternÃ­ administrace** - centrÃ¡lnÃ­ sprÃ¡va vÅ¡ech jÃ­delen a formulÃ¡Å™Å¯ pro superadminy
- **ğŸ“Š PÅ™ehled odpovÄ›dÃ­** - tabulkovÃ½ vÃ½pis a detail jednotlivÃ½ch pÅ™ihlÃ¡Å¡ek
- **ğŸ–¨ï¸ Tisk formulÃ¡Å™Å¯** - moÅ¾nost tisku vyplnÄ›nÃ½ch pÅ™ihlÃ¡Å¡ek
- **ğŸ“§ Email notifikace** - automatickÃ© odesÃ­lÃ¡nÃ­ emailÅ¯ (podÄ›kovÃ¡nÃ­, pÅ™ihlaÅ¡ovacÃ­ Ãºdaje, Å¾Ã¡dost o opravu)
- **ğŸŒ VÃ­cejazyÄnost** - podpora vÃ­ce jazykÅ¯ pro formulÃ¡Å™e

## ğŸ—ï¸ Struktura projektu

```
epks/
â”œâ”€â”€ base/                      # ZÃ¡kladnÃ­ komponenty
â”‚   â””â”€â”€ epks-base-page.component.md
â”œâ”€â”€ boot/                      # Boot soubor pro inicializaci serveru
â”‚   â””â”€â”€ epks.boot.md
â”œâ”€â”€ components/                # GlobÃ¡lnÃ­ komponenty
â”‚   â”œâ”€â”€ base-dialog.component.md
â”‚   â””â”€â”€ client-status.component.md
â”œâ”€â”€ email-layouts/             # Email Å¡ablony
â”‚   â”œâ”€â”€ dekujeme-emali/
â”‚   â”œâ”€â”€ prihlasovaci-email/
â”‚   â”œâ”€â”€ stravnik-udaje-kprihlaseni-emali/
â”‚   â””â”€â”€ zadostoopravu-email/
â”œâ”€â”€ layout/                    # Layout komponenty
â”‚   â”œâ”€â”€ Layout.md
â”‚   â””â”€â”€ index.epks.html.md
â”œâ”€â”€ lib/                       # Knihovny
â”‚   â”œâ”€â”€ central-server.lib.md
â”‚   â”œâ”€â”€ epks.lib.md
â”‚   â””â”€â”€ parseUrl.lib.md
â”œâ”€â”€ pages/                     # StrÃ¡nky aplikace
â”‚   â”œâ”€â”€ administrace/          # Administrace pro jÃ­delny
â”‚   â”œâ”€â”€ form-page/             # HlavnÃ­ formulÃ¡Å™ pÅ™ihlÃ¡Å¡ky
â”‚   â”œâ”€â”€ form-thanks/           # PodÄ›kovÃ¡nÃ­ po odeslÃ¡nÃ­
â”‚   â”œâ”€â”€ hp/                    # Homepage
â”‚   â”œâ”€â”€ interni-administrace/  # CentrÃ¡lnÃ­ sprÃ¡va
â”‚   â”œâ”€â”€ konfigurace-stojanu/   # Konfigurace kioskÅ¯
â”‚   â”œâ”€â”€ login/                 # PÅ™ihlÃ¡Å¡enÃ­
â”‚   â””â”€â”€ login-thanks/          # PodÄ›kovÃ¡nÃ­ po pÅ™ihlÃ¡Å¡enÃ­
â”œâ”€â”€ server/                    # Server-side skripty
â”œâ”€â”€ doc/                       # Dokumentace
â”œâ”€â”€ epks.namespace.md          # Definice namespace
â””â”€â”€ epks.package.md            # Definice balÃ­Äku
```

## ğŸ“„ StrÃ¡nky a funkce

### VeÅ™ejnÃ© strÃ¡nky
- **`/prihlaska/:canteen_slug/:slug_id/:lang?`** - FormulÃ¡Å™ pÅ™ihlÃ¡Å¡ky ke stravovÃ¡nÃ­
- **`/pages/epks/form-thanks`** - PodÄ›kovÃ¡nÃ­ po odeslÃ¡nÃ­ formulÃ¡Å™e
- **`/pages/epks/hp`** - Homepage
- **`/pages/epks/login`** - PÅ™ihlaÅ¡ovacÃ­ strÃ¡nka
- **`/pages/epks/login-thanks`** - PodÄ›kovÃ¡nÃ­ po pÅ™ihlÃ¡Å¡enÃ­

### AdministraÄnÃ­ strÃ¡nky (vyÅ¾adujÃ­ pÅ™ihlÃ¡Å¡enÃ­)
- **`/pages/epks/administrace`** - Administrace pro jednotlivÃ© jÃ­delny
  - ZobrazenÃ­ tabulky pÅ™ihlÃ¡Å¡ek
  - Detail jednotlivÃ½ch odpovÄ›dÃ­
  - Tisk formulÃ¡Å™Å¯
  - NastavenÃ­ formulÃ¡Å™e

- **`/pages/epks/interni-administrace`** - CentrÃ¡lnÃ­ administrace pro superadminy
  - SprÃ¡va vÅ¡ech jÃ­delen
  - SprÃ¡va formulÃ¡Å™Å¯
  - PÅ™ehled pÅ™ihlÃ¡Å¡ek napÅ™Ã­Ä jÃ­delnami

- **`/pages/epks/konfigurace-stojanu`** - Konfigurace kioskÅ¯/stojanÅ¯

## ğŸ”Œ Komponenty

### AdministraÄnÃ­ komponenty
- `epks-admin-response-detail` - Detail jednÃ© pÅ™ihlÃ¡Å¡ky
- `epks-admin-responses-table` - Tabulka vÅ¡ech pÅ™ihlÃ¡Å¡ek
- `epks-admin-settings` - NastavenÃ­ formulÃ¡Å™e
- `epks-admin-print` - Komponenta pro tisk

### FormulÃ¡Å™ovÃ© komponenty
- `epks-main-form` - HlavnÃ­ formulÃ¡Å™ pÅ™ihlÃ¡Å¡ky

### InternÃ­ administraÄnÃ­ komponenty
- `canteens-admin` - SprÃ¡va jÃ­delen
- `canteens-superadmin` - Superadmin sprÃ¡va jÃ­delen
- `epks-forms-admin` - SprÃ¡va formulÃ¡Å™Å¯
- `epks-internal-canteen-responses` - PÅ™ehled odpovÄ›dÃ­ z jÃ­delen
- `epks-internl-canteen-form` - FormulÃ¡Å™ pro jÃ­delny

### OstatnÃ­ komponenty
- `base-dialog` - ZÃ¡kladnÃ­ dialogovÃ© okno
- `client-status` - Status pÅ™ipojenÃ­ klientÅ¯

## ğŸ—„ï¸ DatabÃ¡ze

### EPKS databÃ¡ze
- **Host:** devel.altisima.cz
- **Port:** 10196
- **Database:** epks-dev
- **Schema:** public

### Aktualizace databÃ¡ze
- **Host:** devel.altisima.cz
- **Port:** 10096
- **Database:** aktserver-dev
- **Schema:** public

## ğŸ”— Integrace

### Central Server
Projekt je integrovÃ¡n s **Central Server** pro centrÃ¡lnÃ­ sprÃ¡vu:
- Socket.IO komunikace pro real-time aktualizace
- SprÃ¡va pÅ™ipojenÃ½ch klientÅ¯
- CentrÃ¡lnÃ­ autentizace a autorizace
- Remote restart moÅ¾nost

```js
// Registrace v Central Serveru
{
  customerId: 526,
  version: 'v2.0.1',
  type: 'epks-server',
  description: 'EPKS server instance',
  hostname: os.hostname()
}
```

## ğŸ“§ Email Å¡ablony

SystÃ©m obsahuje nÃ¡sledujÃ­cÃ­ email Å¡ablony:
- **dekujeme.email.md** - PodÄ›kovacÃ­ email po odeslÃ¡nÃ­ pÅ™ihlÃ¡Å¡ky
- **prihlaseni.email.md** - PÅ™ihlaÅ¡ovacÃ­ email s Ãºdaji
- **udajekprihlaseni.email.md** - Email s Ãºdaji k pÅ™ihlÃ¡Å¡enÃ­ pro stravnÃ­ka
- **zadostoopravu.email.md** - Email s Å¾Ã¡dostÃ­ o opravu ÃºdajÅ¯

## ğŸ› ï¸ TechnickÃ© informace

### ENT Framework
Projekt je postaven na **ENT Framework v2**:
- Vue.js 2 + Quasar Framework
- Pug templating engine
- Socket.IO real-time komunikace
- PostgreSQL databÃ¡ze
- Self-modifying architektura

### PouÅ¾itÃ© namespace
- **epks** - hlavnÃ­ namespace projektu
- **base** - zÃ¡kladnÃ­ komponenty z ENT

### Knihovny
- `central-server.lib` - Integrace s Central Serverem
- `epks.lib` - EPKS utility funkce
- `parseUrl.lib` - ParsovÃ¡nÃ­ URL parametrÅ¯

## ğŸš€ Deployment

Projekt bÄ›Å¾Ã­ jako Docker kontejner s nÃ¡sledujÃ­cÃ­mi parametry:
- **Environment:** `local` / `production` (ENV: `ENT_ENV`)
- **Central Server URL:** Konfigurace v `epks.servers.centralServerUrl`

### Boot proces
1. Inicializace databÃ¡zovÃ½ch pÅ™ipojenÃ­ (EPKS + Aktualizace DB)
2. PÅ™ipojenÃ­ k Central Serveru pÅ™es Socket.IO
3. Registrace jako `central-server-epks` namespace
4. PeriodickÃ© naÄÃ­tÃ¡nÃ­ pÅ™ipojenÃ½ch klientÅ¯ (kaÅ¾dÃ½ch 5s)
5. Listener pro remote restart pÅ™Ã­kaz

## ğŸ“ PoslednÃ­ zmÄ›ny

**PoslednÃ­ commit:** `f90e4dd4 - fix: path to libs (2025-09-09)`

**NedÃ¡vnÃ© zmÄ›ny:**
- Oprava cest k knihovnÃ¡m ve vÅ¡ech komponentÃ¡ch a strÃ¡nkÃ¡ch
- Aktualizace komponent administrace
- Ãšprava formulÃ¡Å™ovÃ© strÃ¡nky

## ğŸ“š Dokumentace

Pro vÃ­ce informacÃ­ o ENT frameworku a vÃ½voji komponent viz:
- [[ENT-AGENT-GUIDE.book.md]] - KompletnÃ­ dokumentace ENT objektÅ¯
- [[ent.index.md]] - ENT Framework zÃ¡kladnÃ­ koncepce
- [[vault-mapping.index.md]] - Struktura vault projektÅ¯

## ğŸ” PÅ™Ã­stup a prÃ¡va

### Role v systÃ©mu
1. **Superadmin** - plnÃ½ pÅ™Ã­stup ke vÅ¡em jÃ­delnÃ¡m a nastavenÃ­m
2. **Admin jÃ­delny** - pÅ™Ã­stup k administraci konkrÃ©tnÃ­ jÃ­delny
3. **VeÅ™ejnost** - pÅ™Ã­stup k formulÃ¡Å™i pÅ™ihlÃ¡Å¡ky

---

*Projekt EPKS je souÄÃ¡stÃ­ Altisima Central Vault a je spravovÃ¡n pomocÃ­ git-composer.*