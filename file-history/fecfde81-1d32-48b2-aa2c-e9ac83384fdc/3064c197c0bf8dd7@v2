---
namespace: epks
document:
  enabled: true
  name: epks-emailing-documentation
  tags: [emailing, Å¡ablony, notifikace, email]
  version: v1.0.0
  created: 2025-09-29
---

# EPKS - Email systÃ©m a Å¡ablony

Dokumentace emailovÃ©ho systÃ©mu projektu EPKS. SystÃ©m zajiÅ¡Å¥uje automatickÃ© odesÃ­lÃ¡nÃ­ emailÅ¯ pÅ™i rÅ¯znÃ½ch stavech zpracovÃ¡nÃ­ pÅ™ihlÃ¡Å¡ky ke stravovÃ¡nÃ­.

## ğŸ“§ PÅ™ehled email Å¡ablon

EPKS obsahuje **4 zÃ¡kladnÃ­ email Å¡ablony** umÃ­stÄ›nÃ© v adresÃ¡Å™i `email-layouts/`:

### 1. PodÄ›kovacÃ­ email (dekujeme.email.md)
**ÃšÄel:** AutomatickÃ© potvrzenÃ­ o pÅ™ijetÃ­ vyplnÄ›nÃ©ho formulÃ¡Å™e

**Kdy se odesÃ­lÃ¡:** Ihned po ÃºspÄ›Å¡nÃ©m odeslÃ¡nÃ­ pÅ™ihlÃ¡Å¡ky rodiÄem

**Obsah:**
- PodÄ›kovÃ¡nÃ­ za vyplnÄ›nÃ­ formulÃ¡Å™e
- Informace o nutnosti poÄkat na kontrolu
- Informace o dalÅ¡Ã­m postupu (potvrzovacÃ­ email)
- ZmÃ­nka o e-jÃ­delnÃ­Äek a Å¾olÃ­k pÅ™Ã­stupovÃ½ch ÃºdajÃ­ch (pokud jÃ­delna tyto sluÅ¾by pouÅ¾Ã­vÃ¡)

**VariabilnÃ­ parametry:**
- `lang` - jazyk (cs, sk, en, ua)
- `message` - text pro preheader

**Lokace:** `email-layouts/dekujeme-emali/dekujeme.email.md`

### 2. PÅ™ihlaÅ¡ovacÃ­ email (prihlaseni.email.md)
**ÃšÄel:** ZaslÃ¡nÃ­ odkazu na formulÃ¡Å™ pÅ™ihlÃ¡Å¡ky

**Kdy se odesÃ­lÃ¡:** PÅ™i potÅ™ebÄ› zaslat rodiÄÅ¯m odkaz na formulÃ¡Å™ pÅ™ihlÃ¡Å¡ky

**Obsah:**
- Pozdrav
- Odkaz na formulÃ¡Å™ pÅ™ihlÃ¡Å¡ky
- Pozdrav od tÃ½mu podpory

**VariabilnÃ­ parametry:**
- `url` - URL odkaz na formulÃ¡Å™ (napÅ™. `https://prihlaska.altisima.cz/...`)
- `lang` - jazyk (cs, sk, en, ua)
- `preheader` - text pro preheader

**Lokace:** `email-layouts/prihlasovaci-email/prihlaseni.email.md`

### 3. Email s Ãºdaji k pÅ™ihlÃ¡Å¡enÃ­ (udajekprihlaseni.email.md)
**ÃšÄel:** ZaslÃ¡nÃ­ pÅ™Ã­stupovÃ½ch ÃºdajÅ¯ stravnÃ­kovi po schvÃ¡lenÃ­ pÅ™ihlÃ¡Å¡ky

**Kdy se odesÃ­lÃ¡:** Po zkontrolovÃ¡nÃ­ a schvÃ¡lenÃ­ pÅ™ihlÃ¡Å¡ky administrÃ¡torem jÃ­delny

**Obsah:**
- PotvrzenÃ­ zÃ¡pisu do jÃ­delny
- PÅ™Ã­stupovÃ© Ãºdaje k e-jÃ­delnÃ­Äek
- PÅ™Ã­stupovÃ© Ãºdaje k Å¾olÃ­k (pokud jÃ­delna pouÅ¾Ã­vÃ¡)
- Instrukce k prvnÃ­mu pÅ™ihlÃ¡Å¡enÃ­

**VariabilnÃ­ parametry:**
- `lang` - jazyk (cs, sk, en, ua)
- `loginData` - objekt s pÅ™ihlaÅ¡ovacÃ­mi Ãºdaji
- `canteenName` - nÃ¡zev jÃ­delny

**Lokace:** `email-layouts/stravnik-udaje-kprihlaseni-emali/udajekprihlaseni.email.md`

### 4. Email Å¾Ã¡dost o opravu (zadostoopravu.email.md)
**ÃšÄel:** Å½Ã¡dost o doplnÄ›nÃ­ nebo opravu ÃºdajÅ¯ v pÅ™ihlÃ¡Å¡ce

**Kdy se odesÃ­lÃ¡:** KdyÅ¾ administrÃ¡tor zjistÃ­ chybnÃ© nebo neÃºplnÃ© Ãºdaje

**Obsah:**
- Informace o problÃ©mu s pÅ™ihlÃ¡Å¡kou
- Seznam poÅ¾adovanÃ½ch oprav
- KontaktnÃ­ Ãºdaje pro zpÄ›tnou vazbu
- Instrukce jak postupovat

**VariabilnÃ­ parametry:**
- `lang` - jazyk (cs, sk, en, ua)
- `corrections` - seznam poÅ¾adovanÃ½ch oprav
- `contactEmail` - kontaktnÃ­ email jÃ­delny

**Lokace:** `email-layouts/zadostoopravu-email/zadostoopravu.email.md`

## ğŸŒ VÃ­cejazyÄnost

VÅ¡echny email Å¡ablony podporujÃ­ **4 jazyky**:

| Jazyk | KÃ³d | Popis |
|-------|-----|-------|
| ğŸ‡¨ğŸ‡¿ ÄŒeÅ¡tina | `cs` | VÃ½chozÃ­ jazyk |
| ğŸ‡¸ğŸ‡° SlovenÅ¡tina | `sk` | SlovenskÃ¡ lokalizace |
| ğŸ‡¬ğŸ‡§ AngliÄtina | `en` | AnglickÃ¡ lokalizace |
| ğŸ‡ºğŸ‡¦ UkrajinÅ¡tina | `ua` | UkrajinskÃ¡ lokalizace |

### Implementace jazykÅ¯

Jazyky jsou implementovÃ¡ny pomocÃ­ **Pug conditional statements**:

```pug
if lang === 'cs'
  div
    p DobrÃ½ den,
    p dÄ›kujeme VÃ¡m za vyplnÄ›nÃ­ formulÃ¡Å™e.
else if lang === 'sk'
  div
    p DobrÃ½ deÅˆ,
    p Äakujeme VÃ¡m za vyplnenie formulÃ¡ra.
else if lang === 'en'
  div
    p Hello,
    p Thank you for completing the form.
else if lang === 'ua'
  div
    p ĞŸÑ€Ğ¸Ğ²Ñ–Ñ‚,
    p Ğ´ÑĞºÑƒÑ”Ğ¼Ğ¾ Ğ’Ğ°Ğ¼ Ğ·Ğ° Ğ·Ğ°Ğ¿Ğ¾Ğ²Ğ½ĞµĞ½Ğ½Ñ Ñ„Ğ¾Ñ€Ğ¼Ğ¸.
```

## ğŸ¨ Design a styling

### CSS styling
VÅ¡echny email Å¡ablony pouÅ¾Ã­vajÃ­ **responsive-wide.css** pro zajiÅ¡tÄ›nÃ­ sprÃ¡vnÃ©ho zobrazenÃ­ na rÅ¯znÃ½ch zaÅ™Ã­zenÃ­ch:

```pug
head
  style
    include responsive-wide.css
```

### Layout struktura
Emaily pouÅ¾Ã­vajÃ­ **tabulkovÃ½ layout** pro maximÃ¡lnÃ­ kompatibilitu s email klienty:

```pug
table.body(role="presentation" border="0" cellpadding="0" cellspacing="0")
  tr
    td.container
      .content
        table.main(role="presentation")
          tr
            td.wrapper
              // Obsah emailu
```

### Preheader
KaÅ¾dÃ½ email obsahuje **preheader** - krÃ¡tkÃ½ text zobrazenÃ½ v nÃ¡hledu emailu pÅ™ed otevÅ™enÃ­m:

```pug
span.preheader #{message}
```

## ğŸ“¬ Footer vÅ¡ech emailÅ¯

VÅ¡echny emaily obsahujÃ­ **jednotnÃ½ footer** s kontaktnÃ­mi Ãºdaji:

```
Altisima software SE
KubelÃ­kova 46, 130 00 Praha 3
Telefon: +420 222 711 241
Web: www.altisima.cz
```

## ğŸ”§ TechnickÃ¡ implementace

### ENT email objekty
Email Å¡ablony jsou definovÃ¡ny jako **emailTemplate** objekty:

```yaml
---
emailTemplate:
  enabled: true
  namespace: epks
  name: dekujeme
wikiPage:
  enabled: true
  name: dekujeme-email
  parent: emails
  wiki: epks
---
```

### Rendering Å¡ablon
1. **Pug template engine** - Å¡ablony jsou psÃ¡ny v Pugu
2. **Parametry** - Å¡ablony pÅ™ijÃ­majÃ­ parametry (url, lang, message, atd.)
3. **Kompilace** - ENT framework kompiluje Pug do HTML
4. **OdesÃ­lÃ¡nÃ­** - HTML email je odeslÃ¡n pomocÃ­ SMTP serveru

### VolÃ¡nÃ­ z komponent

```js
// V komponentÄ›/store - volÃ¡nÃ­ API pro odeslÃ¡nÃ­ emailu
await this.callRestApi({
  func: 'sendEmail',
  payload: {
    emailType: 'dekujeme',
    lang: 'cs',
    recipientEmail: 'parent@example.com',
    data: {
      message: 'DÄ›kujeme za vyplnÄ›nÃ­ pÅ™ihlÃ¡Å¡ky'
    }
  }
})
```

## ğŸ“Š Workflow odesÃ­lÃ¡nÃ­ emailÅ¯

### 1. OdeslÃ¡nÃ­ pÅ™ihlÃ¡Å¡ky
```
RodiÄ vyplnÃ­ formulÃ¡Å™
    â†“
FormulÃ¡Å™ se uloÅ¾Ã­ do DB
    â†“
AutomatickÃ© odeslÃ¡nÃ­ "dekujeme" emailu
    â†“
Status: ÄekÃ¡ na kontrolu
```

### 2. SchvÃ¡lenÃ­ pÅ™ihlÃ¡Å¡ky
```
AdministrÃ¡tor zkontroluje pÅ™ihlÃ¡Å¡ku
    â†“
PÅ™ihlÃ¡Å¡ka schvÃ¡lena
    â†“
AutomatickÃ© odeslÃ¡nÃ­ "udajekprihlaseni" emailu
    â†“
Status: schvÃ¡leno
```

### 3. Å½Ã¡dost o opravu
```
AdministrÃ¡tor najde chybu
    â†“
OznaÄÃ­ poloÅ¾ky k opravÄ›
    â†“
AutomatickÃ© odeslÃ¡nÃ­ "zadostoopravu" emailu
    â†“
Status: ÄekÃ¡ na opravu
```

### 4. ZaslÃ¡nÃ­ odkazu na formulÃ¡Å™
```
RodiÄ poÅ¾Ã¡dÃ¡ o odkaz
    â†“
AdministrÃ¡tor vygeneruje odkaz
    â†“
OdeslÃ¡nÃ­ "prihlaseni" emailu s URL
    â†“
RodiÄ mÅ¯Å¾e vyplnit formulÃ¡Å™
```

## ğŸ› ï¸ SprÃ¡va emailÅ¯ v administraci

### AdministrÃ¡torskÃ© funkce
- **NÃ¡hled emailu** - pÅ™ed odeslÃ¡nÃ­m moÅ¾nost zobrazit nÃ¡hled
- **TestovacÃ­ odeslÃ¡nÃ­** - moÅ¾nost odeslat testovacÃ­ email
- **Historie odeslanÃ½ch emailÅ¯** - pÅ™ehled vÅ¡ech odeslanÃ½ch emailÅ¯
- **Å ablony** - moÅ¾nost Ãºpravy Å¡ablon (pro superadmina)

### Log odeslanÃ½ch emailÅ¯
KaÅ¾dÃ© odeslÃ¡nÃ­ emailu je zaznamenÃ¡no:
- Datum a Äas odeslÃ¡nÃ­
- PÅ™Ã­jemce
- Typ emailu
- Jazyk
- Status doruÄenÃ­

## ğŸ” BezpeÄnost

### Ochrana pÅ™ed spamem
- **Rate limiting** - omezenÃ­ poÄtu emailÅ¯ za ÄasovÃ½ interval
- **Validace emailovÃ½ch adres** - kontrola platnosti pÅ™ed odeslÃ¡nÃ­m
- **CAPTCHA** - ochrana formulÃ¡Å™e pÅ™ed boty

### GDPR compliance
- **Souhlas se zpracovÃ¡nÃ­m** - rodiÄ musÃ­ souhlasit s GDPR
- **MoÅ¾nost odhlÃ¡Å¡enÃ­** - moÅ¾nost zruÅ¡it zasÃ­lÃ¡nÃ­ emailÅ¯
- **UchovÃ¡vÃ¡nÃ­ dat** - emaily uchovÃ¡ny dle zÃ¡konnÃ½ch poÅ¾adavkÅ¯

## ğŸ“ Best practices

### Pro vÃ½vojÃ¡Å™e
1. **VÅ¾dy testuj** - pÅ™ed nasazenÃ­m otestuj vÅ¡echny jazykovÃ© verze
2. **Responzivita** - ovÄ›Å™ zobrazenÃ­ na rÅ¯znÃ½ch zaÅ™Ã­zenÃ­ch
3. **Email klienti** - testuj v rÅ¯znÃ½ch email klientech (Gmail, Outlook, Apple Mail)
4. **Fallbacky** - vÅ¾dy pÅ™iprav fallback pro nepodporovanÃ© funkce

### Pro administrÃ¡tory
1. **Kontrola pÅ™ed odeslÃ¡nÃ­m** - vÅ¾dy zkontroluj Ãºdaje pÅ™ed odeslÃ¡nÃ­m
2. **SprÃ¡vnÃ¡ Å¡ablona** - pouÅ¾ij sprÃ¡vnÃ½ typ emailu pro danou situaci
3. **Jazyk pÅ™Ã­jemce** - odeÅ¡li email ve sprÃ¡vnÃ©m jazyce
4. **Follow-up** - sleduj, zda rodiÄ reagoval na email

## ğŸ” Debugging

### Jak debugovat emaily

```js
// V console mÅ¯Å¾eÅ¡ zkontrolovat parametry emailu
console.log('ZZZ Email params:', {
  emailType: 'dekujeme',
  lang: 'cs',
  recipient: email,
  data: emailData
})
```

### ÄŒastÃ© problÃ©my
- **Email nedorazil** - zkontroluj spam sloÅ¾ku
- **Å patnÃ© formÃ¡tovÃ¡nÃ­** - problÃ©m s CSS v email klientovi
- **ChybnÃ½ jazyk** - nesprÃ¡vnÄ› pÅ™edanÃ½ `lang` parametr
- **ChybÄ›jÃ­cÃ­ URL** - chybÄ›jÃ­cÃ­ nebo nevalidnÃ­ `url` parametr

## ğŸ“š SouvisejÃ­cÃ­ dokumentace

- [[doc/administration]] - Dokumentace administrace
- [[epks-form]] - Dokumentace hlavnÃ­ho formulÃ¡Å™e
- [[epks.boot]] - Konfigurace SMTP serveru

---

*PoslednÃ­ aktualizace: 2025-09-29*
*Autor: Brain Documentation Keeper*