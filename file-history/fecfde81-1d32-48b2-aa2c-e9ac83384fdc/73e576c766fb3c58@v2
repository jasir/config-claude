---
namespace: epks
document:
  enabled: true
  name: epks-administration-documentation
  tags: [administrace, správa, přihlášky, jídelna]
  version: v1.0.0
  created: 2025-09-29
---

# EPKS - Administrace systému

Dokumentace administračního rozhraní projektu EPKS pro správu elektronických přihlášek ke stravování.

## 🎯 Přehled administrace

EPKS má **3 úrovně administrace**:

### 1. 👨‍🍳 Administrace jídelny
**URL:** `/administrace/:canteen_slug`
**Účel:** Správa přihlášek pro konkrétní jídelnu
**Přístup:** Administrátor jednotlivé jídelny (vyžaduje přihlášení heslem)

### 2. 🔐 Interní administrace
**URL:** `/pages/epks/interni-administrace`
**Účel:** Centrální správa všech jídelen a formulářů
**Přístup:** Superadmin (vyžaduje přihlášení do ENT systému)

### 3. ⚙️ Konfigurace stojanů
**URL:** `/pages/epks/konfigurace-stojanu`
**Účel:** Konfigurace kiosků/stojanů pro samoobslužné vyplňování
**Přístup:** Administrátor nebo superadmin

## 📋 Administrace jídelny (epks-admin.page.md)

### Základní informace
- **Stránka:** `pages/administrace/epks-admin.page.md`
- **Route:** `epks/administrace/:rest(*)`
- **Public route:** `/administrace`
- **Layout:** Custom s vlastním headerem

### Funkce
- **Přihlášení heslem** - zabezpečený přístup k přihláškám
- **Seznam přihlášek** - tabulka všech přihlášek s filtrováním
- **Detail přihlášky** - zobrazení a úprava jednotlivé přihlášky
- **Tisk formuláře** - možnost vytisknout vyplněný formulář
- **Nastavení** - konfigurace formuláře pro jídelnu

### Struktura dat

```js
// Persistent data - uchovává se v localStorage
{
  isLogged: false,      // Je uživatel přihlášen?
  editedTab: 'seznam'   // Aktivní tab (seznam/nastavení)
}

// Server data - načítá se ze serveru
{
  canteen: 'loading'    // Data o jídelně
}

// URL parametry
{
  canteen_slug: 'string' // Slug jídelny (např. 'zakladni-skola-praha')
}
```

### Taby v administraci

#### Tab "Seznam"
Zobrazuje tabulku všech přihlášek pomocí komponenty [[epks.admin-responses-table]]

#### Tab "Nastavení"
Konfigurace formuláře pomocí komponenty [[epks.admin-settings]]

## 📊 Tabulka přihlášek (AdminResponsesTable)

### Základní informace
- **Komponenta:** `pages/administrace/components/epks.admin-responses-table.component.md`
- **Účel:** Zobrazení seznamu všech přihlášek s možností filtrování a řazení

### Props
```js
{
  canteenId: Number,    // ID jídelny
  canteen: Object       // Objekt jídelny s nastavením
}
```

### Filtry a stavy přihlášek

#### Stavy přihlášek
| ID | Stav | Popis |
|---|---|---|
| 2 | Nezpracované | Nově příchozí přihlášky čekající na kontrolu |
| 3 | Čeká na opravu | Přihláška vrácena rodičům k opravě |
| 4 | Zpracované | Zkontrolované a schválené přihlášky |
| 5 | Archivované | Starší přihlášky přesunuté do archivu |
| 99 | Vadné | Přihlášky s chybami, které nelze opravit |

#### Filtrovací možnosti
```js
filter: {
  text: '',              // Fulltextové hledání
  nezpracovane: true,    // Zobrazit nezpracované
  archivovane: false,    // Zobrazit archivované
  vlozene: false,        // Zobrazit vložené do systému
  vadne: false,          // Zobrazit vadné
  zpracovane: false,     // Zobrazit zpracované
}
```

### Persistentní data
Filtry a nastavení se **ukládají do localStorage**:
```js
persistentData: {
  filter: { keys: ['filter', 'editedFilterStatuses'] },
  options: { keys: ['options'] }
}
```

### Automatické načítání
Tabulka se **automaticky aktualizuje každých 5 sekund**:
```js
timers: {
  reloadServerData: {
    time: 5000,      // 5 sekund
    autostart: true,
    repeat: true
  }
}
```

### Quick filter
Rychlé vyhledávání v tabulce pro okamžité filtrování dle:
- Jméno a příjmení stravníka
- Email zákonného zástupce
- Telefon zákonného zástupce
- Variabilní symbol

### Funkce v tabulce
- **Kliknutí na řádek** - otevře detail přihlášky
- **Barevné označení** - různé barvy pro různé stavy
- **Řazení** - možnost řadit podle sloupců
- **Export** - možnost exportu do CSV/Excel

## 📝 Detail přihlášky (AdminResponseDetail)

### Základní informace
- **Komponenta:** `pages/administrace/components/epks.admin-response-detail.component.md`
- **Účel:** Zobrazení a úprava jednotlivé přihlášky

### Props
```js
{
  responseId: Number,          // ID přihlášky
  initialResponse: Object,     // Původní data přihlášky
  canteen: Object,            // Data jídelny
  options: Object             // Nastavení zobrazení
}
```

### Editovatelná pole

#### Základní údaje
```js
{
  editedTrida: undefined,           // Školní třída
  editedKategorie: '',              // Kategorie stravníka
  editedDatumZacatku: '',          // Datum začátku stravování
  editedJmeno: '',                  // Jméno stravníka
  variabilniSymbol: ''              // VS pro platby
}
```

#### Email žádosti o opravu
```js
{
  editedOpravaText: 'Dobrý den, prosím opravte... ',
  editedOpravaEmail: '',            // Email příjemce
  editedOpravaBccEmail: '',         // BCC kopie
  editedOpravaBcc: true            // Poslat BCC?
}
```

#### Finální email po schválení
```js
{
  editedFinalEmail: '',             // Email s přístupovými údaji
  editedFinalBccEmail: '',          // BCC kopie
  editedFinalBcc: false            // Poslat BCC?
}
```

### Validace

#### Variabilní symbol
```js
validations: {
  variabilniSymbol: {
    isUnique: async (value) => {
      // Kontrola, zda VS není již použitý
      return await vm.isVariableSymbolUnique(value)
    }
  }
}
```

**Chybové hlášky:**
- `required`: "informaci musíte vyplnit"
- `isUnique`: "variabilní symbol již byl přidělen jinému strávníkovi"

### Server data
```js
serverData: {
  response: 'loading',        // Data přihlášky
  insertedInfo: 'loading'     // Info o vložení do systému
}
```

### Akce v detailu

#### 1. 💾 Uložit změny
- Uloží editované údaje do databáze
- Aktualizuje stav přihlášky

#### 2. ✉️ Poslat žádost o opravu
- Změní stav na "čeká na opravu"
- Odešle email rodičům s požadavky na opravu
- Možnost BCC kopie pro jídelnu

#### 3. ✅ Schválit přihlášku
- Změní stav na "zpracované"
- Odešle email s přístupovými údaji
- Vloží stravníka do systému (pokud je integrace)

#### 4. 🗑️ Archivovat
- Změní stav na "archivované"
- Přesune přihlášku mimo aktivní seznam

#### 5. ⚠️ Označit jako vadnou
- Změní stav na "vadné"
- Pro přihlášky, které nelze zpracovat

#### 6. 🖨️ Vytisknout
- Otevře [[epks.admin-print]] komponentu
- Připraví formulář pro tisk

## 🖨️ Tisk formuláře (AdminPrint)

### Základní informace
- **Komponenta:** `pages/administrace/components/epks.admin-print.component.md`
- **Účel:** Tisk vyplněné přihlášky v čitelném formátu

### Funkce
- **Formátované zobrazení** - všechny údaje přehledně
- **Logo jídelny** - vlastní logo v záhlaví
- **QR kód** - pro rychlý přístup k přihlášce
- **Podpisová pole** - pro rodiče a administrátora
- **CSS pro tisk** - optimalizované styly pro tiskárnu

### Tiskové formáty
- **A4 na výšku** - standardní formát
- **Bez barev** - optimalizováno pro černobílý tisk
- **Stránkování** - automatické rozdělení na stránky

## ⚙️ Nastavení formuláře (AdminSettings)

### Základní informace
- **Komponenta:** `pages/administrace/components/epks.admin-settings.component.md`
- **Účel:** Konfigurace formuláře pro jídelnu

### Nastavitelné položky

#### Základní informace
- **Název jídelny** - zobrazovaný název
- **Logo** - nahrání loga jídelny
- **Kontaktní email** - pro notifikace
- **Jazyky** - aktivní jazykové mutace

#### Formulářové pole
- **Povinná pole** - výběr povinných polí
- **Skrytá pole** - výběr skrytých polí
- **Výchozí hodnoty** - předvyplnění polí

#### Email nastavení
- **BCC adresa** - automatická kopie všech emailů
- **Šablony** - výběr emailových šablon
- **Podpis** - vlastní podpis v emailech

#### Integrace
- **E-jídelníček** - integrace s e-jídelníček systémem
- **Žolík** - integrace s žolík platbami
- **Central Server** - napojení na centrální server

#### Vzhled
- **Barvy** - vlastní barevné schéma
- **Fonty** - výběr fontů
- **CSS** - vlastní CSS styly

## 🏢 Interní administrace

### Základní informace
- **Stránka:** `pages/interni-administrace/epks-interni-administrace.page.md`
- **Route:** `/pages/epks/interni-administrace`
- **Přístup:** Jen pro superadminy přihlášené v ENT systému

### Komponenty interní administrace

#### 1. Správa jídelen (CanteensAdmin)
**Komponenta:** `canteens-admin.component.md`

**Funkce:**
- Seznam všech jídelen
- Vytvoření nové jídelny
- Úprava údajů jídelny
- Deaktivace/aktivace jídelny
- Generování slug pro URL
- Nastavení hesla pro administraci

#### 2. Superadmin jídelen (CanteensSuperadmin)
**Komponenta:** `canteens-superadmin.component.md`

**Rozšířené funkce:**
- Přístup ke všem jídelnám
- Změna vlastnictví jídelen
- Migrace dat mezi jídelnami
- Statistiky napříč systémem
- Export všech dat

#### 3. Správa formulářů (FormsAdmin)
**Komponenta:** `epks.forms-admin.component.md`

**Funkce:**
- Globální šablony formulářů
- Vytvoření nového typu formuláře
- Klonování formulářů
- Nastavení polí pro všechny jídelny
- Verzování formulářů

#### 4. Přehled odpovědí (InternalCanteenResponses)
**Komponenta:** `epks.internal-canteen-responses.component.md`

**Funkce:**
- Celkový přehled přihlášek
- Filtrování podle jídelen
- Statistiky úspěšnosti
- Export dat
- Hromadné operace

#### 5. Formulář pro jídelny (InternlCanteenForm)
**Komponenta:** `epks.internl-canteen-form.component.md`

**Funkce:**
- Vytvoření/úprava jídelny
- Nastavení integrací
- Konfigurace emailů
- Přiřazení administrátorů

## 🔐 Přihlášení a autentizace

### Přihlášení do administrace jídelny

```js
// Jednoduché přihlášení heslem
async login() {
  const result = await this.callRestApi({
    func: 'loginCanteen',
    payload: {
      canteenSlug: this.canteen_slug,
      password: this.password
    }
  })

  if (result.success) {
    this.isLogged = true
    this.loginError = false
  } else {
    this.loginError = true
  }
}
```

### Přihlášení do interní administrace
- Používá **ENT autentizaci**
- Kontrola uživatelských práv
- Session management
- Token-based autorizace

## 📊 Workflow administrace

### Proces zpracování přihlášky

```
1. Nová přihláška přijde (status: nezpracované)
   ↓
2. Administrátor otevře detail
   ↓
3. Zkontroluje všechny údaje
   ↓
4a. Vše OK → Schválí přihlášku
    → Status: zpracované
    → Odešle email s přístupovými údaji
    → Vloží do systému stravování

4b. Chyba → Žádost o opravu
    → Status: čeká na opravu
    → Odešle email s požadavky
    → Čeká na reakci rodiče

4c. Nelze zpracovat → Vadná
    → Status: vadné
    → Kontaktuje rodiče jiným způsobem
```

## 🛠️ Best practices pro administrátory

### ✅ Doporučené postupy

1. **Pravidelná kontrola** - minimálně 1x denně zkontrolovat nové přihlášky
2. **Rychlá reakce** - odpovědět do 24 hodin od přijetí přihlášky
3. **Jasná komunikace** - v emailech jasně popsat, co je třeba opravit
4. **Archivace** - starší přihlášky archivovat pro přehlednost
5. **Záloha** - pravidelně exportovat data pro zálohu

### ❌ Časté chyby

1. **Neschválení bez emailu** - vždy odeslat potvrzovací email
2. **Duplikátní VS** - kontrolovat unikátnost variabilních symbolů
3. **Zapomenutí BCC** - nastavit automatické BCC pro evidenci
4. **Neúplné údaje** - zkontrolovat všechny povinné položky

## 🔍 Debugging a řešení problémů

### Časté problémy

#### Přihlášky se nenačítají
```js
// Zkontroluj konzoli
console.log('ZZZ rawResponses:', this.rawResponses)
console.log('ZZZ canteenId:', this.canteenId)
```

#### Email se neodeslal
```js
// Zkontroluj email parametry
console.log('ZZZ email params:', {
  recipient: this.editedOpravaEmail,
  type: 'oprava',
  canteen: this.canteen
})
```

#### Filtr nefunguje
```js
// Zkontroluj filter objekt
console.log('ZZZ filter:', this.filter)
console.log('ZZZ filtered results:', this.filteredResponses)
```

## 📱 Responzivita

Administrace je **plně responzivní**:
- **Desktop** - plná funkčnost, vše na jedné obrazovce
- **Tablet** - přizpůsobený layout, skrývání některých sloupců
- **Mobile** - zjednodušené zobrazení, karta místo tabulky

## 📚 Související dokumentace

- [[doc/emailing]] - Dokumentace email systému
- [[doc/components/epks-main-form]] - Dokumentace hlavního formuláře
- [[epks.boot]] - Konfigurace serveru a databáze

---

*Poslední aktualizace: 2025-09-29*
*Autor: Brain Documentation Keeper*